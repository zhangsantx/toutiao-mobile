{"version":3,"sources":["webpack:///./src/views/login/index.vue?7dbd","webpack:///src/views/login/index.vue","webpack:///./src/views/login/index.vue?a2f2","webpack:///./src/views/login/index.vue?b0dd","webpack:///./src/api/user.js","webpack:///./src/views/login/index.vue?ffe0"],"names":["render","_vm","this","_h","$createElement","_c","_self","staticClass","attrs","on","$event","$router","back","ref","onLogin","onFiled","formRules","mobile","model","value","user","callback","$$v","$set","expression","code","scopedSlots","_u","key","fn","isShowCountDown","isSendSmsLoading","preventDefault","onSendSms","apply","arguments","_v","proxy","_m","staticRenderFns","name","data","methods","err","errors","$toast","message","position","component","login","request","method","url","sendSms","getCurrentUser","getUserChannels","addFollow","userId","target","deleteFollow","getUserProfile","updateUserProfile","updateUserPhoto"],"mappings":"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","file":"js/chunk-3c3c0a1a.d988c002.js","sourcesContent":["var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"login-container\"},[_c('van-nav-bar',{attrs:{\"title\":\"登录 / 注册\",\"left-arrow\":\"\"},on:{\"click-left\":function($event){return _vm.$router.back()}}}),_c('van-form',{ref:\"login-form\",attrs:{\"show-error-message\":false,\"show-error\":false,\"validate-first\":\"\"},on:{\"submit\":_vm.onLogin,\"failed\":_vm.onFiled}},[_c('van-cell-group',[_c('van-field',{staticClass:\"text-mobile\",attrs:{\"icon-prefix\":\"toutiao\",\"left-icon\":\"shouji\",\"placeholder\":\"请输入手机号\",\"name\":\"mobile\",\"rules\":_vm.formRules.mobile},model:{value:(_vm.user.mobile),callback:function ($$v) {_vm.$set(_vm.user, \"mobile\", $$v)},expression:\"user.mobile\"}}),_c('van-field',{attrs:{\"icon-prefix\":\"toutiao\",\"clearable\":\"\",\"left-icon\":\"yanzhengma\",\"placeholder\":\"请输入验证码\",\"name\":\"code\",\"rules\":_vm.formRules.code},scopedSlots:_vm._u([{key:\"button\",fn:function(){return [(!_vm.isShowCountDown)?_c('van-button',{staticClass:\"send-btn\",attrs:{\"border\":\"\",\"size\":\"mini\",\"type\":\"info\",\"round\":\"\",\"loading\":_vm.isSendSmsLoading},on:{\"click\":function($event){$event.preventDefault();return _vm.onSendSms.apply(null, arguments)}}},[_vm._v(\"获取验证码\")]):_c('van-button',{staticClass:\"send-btn-countdown\",attrs:{\"border\":\"\",\"size\":\"mini\",\"type\":\"default\",\"round\":\"\",\"disabled\":\"\"}},[_c('van-count-down',{attrs:{\"time\":1000 * 60,\"format\":\"sss后重新获取\"},on:{\"finish\":function($event){_vm.isShowCountDown = false}}})],1)]},proxy:true}]),model:{value:(_vm.user.code),callback:function ($$v) {_vm.$set(_vm.user, \"code\", $$v)},expression:\"user.code\"}})],1),_c('div',{staticClass:\"login-btn-warp\"},[_c('van-button',{staticClass:\"login-btn\",attrs:{\"type\":\"info\",\"block\":\"\"}},[_vm._v(\"登录\")])],1)],1),_vm._m(0)],1)}\nvar staticRenderFns = [function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"clause-warp\"},[_c('span',{staticClass:\"clause-info\"},[_vm._v(\"隐私政策\")])])}]\n\nexport { render, staticRenderFns }","<template>\r\n  <div class=\"login-container\">\r\n    <van-nav-bar title=\"登录 / 注册\" left-arrow @click-left=\"$router.back()\" />\r\n    <!-- 登录表单 -->\r\n    <van-form :show-error-message=\"false\" :show-error=\"false\" validate-first ref=\"login-form\" @submit=\"onLogin\" @failed=\"onFiled\">\r\n      <van-cell-group>\r\n        <van-field\r\n          class=\"text-mobile\"\r\n          v-model=\"user.mobile\"\r\n          icon-prefix=\"toutiao\"\r\n          left-icon=\"shouji\"\r\n          placeholder=\"请输入手机号\"\r\n          name=\"mobile\"\r\n          :rules=\"formRules.mobile\"\r\n        />\r\n        <van-field v-model=\"user.code\" icon-prefix=\"toutiao\" clearable left-icon=\"yanzhengma\" placeholder=\"请输入验证码\" name=\"code\" :rules=\"formRules.code\">\r\n          <template #button>\r\n            <van-button v-if=\"!isShowCountDown\" class=\"send-btn\" border size=\"mini\" type=\"info\" round :loading=\"isSendSmsLoading\" @click.prevent=\"onSendSms\"\r\n              >获取验证码</van-button\r\n            >\r\n            <van-button v-else class=\"send-btn-countdown\" border size=\"mini\" type=\"default\" round disabled>\r\n              <van-count-down :time=\"1000 * 60\" format=\"sss后重新获取\" @finish=\"isShowCountDown = false\" />\r\n            </van-button>\r\n          </template>\r\n        </van-field>\r\n      </van-cell-group>\r\n      <div class=\"login-btn-warp\">\r\n        <van-button type=\"info\" block class=\"login-btn\">登录</van-button>\r\n      </div>\r\n    </van-form>\r\n    <div class=\"clause-warp\">\r\n      <span class=\"clause-info\">隐私政策</span>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport { login, sendSms } from '@/api/user'\r\nexport default {\r\n  name: 'LoginIndex',\r\n  data() {\r\n    return {\r\n      user: {\r\n        mobile: '13911111111', // 手机号\r\n        code: '246810' // 验证码\r\n      },\r\n      formRules: {\r\n        mobile: [\r\n          { required: true, message: '请输入手机号' },\r\n          { pattern: /^(13[0-9]|14[01456879]|15[0-35-9]|16[2567]|17[0-8]|18[0-9]|19[0-35-9])\\d{8}$/, message: '手机号格式错误' }\r\n        ],\r\n        code: [\r\n          { required: true, message: '请输入验证码' },\r\n          { pattern: /^\\d{6}$/, message: '验证码格式错误' }\r\n        ]\r\n      },\r\n      isShowCountDown: false, // 控制倒计时和发送验证码按钮状态\r\n      isSendSmsLoading: false // 控制发送验证码按钮的loading状态\r\n    }\r\n  },\r\n  methods: {\r\n    // 用户登录\r\n    async onLogin() {\r\n      // 开启loading\r\n      this.$toast.loading({\r\n        message: '加载中...',\r\n        forbidClick: true,\r\n        duration: 0\r\n      })\r\n      try {\r\n        const { data } = await login(this.user)\r\n        // 登录成功\r\n        this.$toast.success('登录成功')\r\n        // 存储用户登录状态token等数据报错到vuex中\r\n        console.log(data.data)\r\n        this.$store.commit('setUser', data.data)\r\n\r\n        // 移除layout页面缓存，重新渲染\r\n        this.$store.commit('removeCachePage', 'LayoutIndex')\r\n\r\n        // 跳转原来的页面(临时解决方案)\r\n        // this.$router.back()\r\n        this.$router.push(this.$route.query.redirect || '/')\r\n      } catch (err) {\r\n        // 登录失败\r\n        this.$toast({\r\n          message: '手机号或验证码错误',\r\n          position: 'top'\r\n        })\r\n      }\r\n    },\r\n    // 表单验证失败\r\n    onFiled(err) {\r\n      if (err.errors[0]) {\r\n        this.$toast({\r\n          message: err.errors[0].message,\r\n          position: 'top'\r\n        })\r\n      }\r\n    },\r\n    // 获取验证码\r\n    async onSendSms() {\r\n      // 校验手机号\r\n      try {\r\n        await this.$refs['login-form'].validate('mobile')\r\n        // 验证成功\r\n        // 开启loading\r\n        this.isSendSmsLoading = true\r\n        await sendSms(this.user.mobile)\r\n        this.isShowCountDown = true\r\n        this.$toast({\r\n          message: '验证码发送成功，请注意查收',\r\n          position: 'top'\r\n        })\r\n      } catch (err) {\r\n        // 验证失败\r\n        let message = ''\r\n        if (err && err.response && err.response.status === 429) {\r\n          // 验证码发送频繁\r\n          message = '操作太频繁了，请稍后重试'\r\n        } else if (err.name === 'mobile') {\r\n          // 手机号校验失败\r\n          message = err.message\r\n        } else {\r\n          // 未知错误\r\n          message = '验证码发送失败'\r\n        }\r\n        this.$toast({\r\n          message,\r\n          position: 'top'\r\n        })\r\n      }\r\n      // 关闭loading\r\n      this.isSendSmsLoading = false\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style lang=\"less\" scoped>\r\n.login-container {\r\n  position: relative;\r\n  height: 100vh;\r\n  .login-btn-warp {\r\n    padding: 26px 16px;\r\n    .login-btn {\r\n      border: none;\r\n      border-radius: 5px;\r\n      .van-button__text {\r\n        font-size: 15px;\r\n      }\r\n    }\r\n  }\r\n  .text-mobile {\r\n    padding-left: 0;\r\n    padding-right: 0;\r\n    margin: 0 15px;\r\n    width: 92%;\r\n    border-bottom: 1px solid #eee;\r\n  }\r\n  .send-btn {\r\n    position: relative;\r\n    height: 23px;\r\n    min-width: 76px;\r\n    font-size: 11px;\r\n    display: flex;\r\n    align-items: center;\r\n    justify-content: center;\r\n  }\r\n  .send-btn-countdown {\r\n    background-color: #ededed;\r\n    display: flex;\r\n    align-items: center;\r\n    justify-content: center;\r\n    .van-count-down {\r\n      font-size: 11px;\r\n      color: #666666;\r\n    }\r\n  }\r\n  .clause-warp {\r\n    .clause-info {\r\n      position: absolute;\r\n      bottom: 27px;\r\n      left: 50%;\r\n      transform: translateX(-50%);\r\n      color: #666;\r\n      font-size: 12px;\r\n    }\r\n  }\r\n}\r\n</style>\r\n","import mod from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--13-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./index.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--13-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./index.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./index.vue?vue&type=template&id=3a4e0d46&scoped=true&\"\nimport script from \"./index.vue?vue&type=script&lang=js&\"\nexport * from \"./index.vue?vue&type=script&lang=js&\"\nimport style0 from \"./index.vue?vue&type=style&index=0&id=3a4e0d46&lang=less&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"3a4e0d46\",\n  null\n  \n)\n\nexport default component.exports","// 用户相关请求模块\r\nimport request from '@/utils/request'\r\n\r\n// 用户登录\r\nexport const login = (data) => {\r\n  return request({\r\n    method: 'POST',\r\n    url: '/app/v1_0/authorizations',\r\n    data\r\n  })\r\n}\r\n\r\n// 获取短信验证码\r\nexport const sendSms = (mobile) => {\r\n  return request({\r\n    method: 'GET',\r\n    url: `/app/v1_0/sms/codes/${mobile}`\r\n  })\r\n}\r\n\r\n// 获取登录用户信息\r\nexport const getCurrentUser = (mobile) => {\r\n  return request({\r\n    method: 'GET',\r\n    url: '/app/v1_0/user'\r\n    // headers: {\r\n    //   Authorization: `Bearer ${store.state.user.token}`\r\n    // }\r\n  })\r\n}\r\n\r\n// 获取用户频道列表\r\nexport const getUserChannels = () => {\r\n  return request({\r\n    method: 'GET',\r\n    url: '/app/v1_0/user/channels'\r\n  })\r\n}\r\n\r\n// 关注用户\r\nexport const addFollow = (userId) => {\r\n  return request({\r\n    method: 'POST',\r\n    url: '/app/v1_0/user/followings',\r\n    data: {\r\n      target: userId\r\n    }\r\n  })\r\n}\r\n// 取消关注用户\r\nexport const deleteFollow = (userId) => {\r\n  return request({\r\n    method: 'DElETE',\r\n    url: `/app/v1_0/user/followings/${userId}`\r\n  })\r\n}\r\n\r\n// 获取用户个人资料\r\nexport const getUserProfile = () => {\r\n  return request({\r\n    method: 'GET',\r\n    url: '/app/v1_0/user/profile'\r\n  })\r\n}\r\n\r\n// 修改用户资料\r\nexport const updateUserProfile = (data) => {\r\n  return request({\r\n    method: 'PATCH',\r\n    url: '/app/v1_0/user/profile',\r\n    data\r\n  })\r\n}\r\n\r\n// 修改用户照片资料（头像、身份证等）\r\nexport const updateUserPhoto = (data) => {\r\n  return request({\r\n    method: 'PATCH',\r\n    url: '/app/v1_0/user/photo',\r\n    data\r\n  })\r\n}\r\n","export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--11-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--11-oneOf-1-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--11-oneOf-1-2!../../../node_modules/less-loader/dist/cjs.js??ref--11-oneOf-1-3!../../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./index.vue?vue&type=style&index=0&id=3a4e0d46&lang=less&scoped=true&\""],"sourceRoot":""}